---
import '../styles/global.css'
import { sanityClient } from '../lib/sanity'
import Navbar2, { type NavLink } from '@/components/starwind-pro/navbar-02/Navbar2.astro'
import Footer3, { type FooterColumn } from '@/components/starwind-pro/footer-03/Footer3.astro'

interface Props {
  title?: string
  seoTitle?: string
  seoDescription?: string
  ogImage?: any
}

const { title = 'MetaVivo', seoTitle, seoDescription } = Astro.props

const settings = await sanityClient.fetch(`*[_type == "siteSettings"][0]{
  siteName,
  favicon{ asset->{ url } },
  nav{
    links[]{ label, url },
    ctaButton{ label, url }
  },
  footer{
    tagline,
    columns[]{
      heading,
      links[]{ label, url }
    }
  }
}`)

const pageTitle = seoTitle || title

// Map Sanity nav links (url) → Navbar2 NavLink (href)
const navLinks: NavLink[] = (settings?.nav?.links || []).map((link: any) => ({
  label: link.label,
  href: link.url,
}))
const ctaButton = settings?.nav?.ctaButton

// Map Sanity footer columns (heading, url) → Footer3 FooterColumn (title, href)
const footerColumns: FooterColumn[] = (settings?.footer?.columns || []).map((col: any) => ({
  title: col.heading,
  links: (col.links || []).map((link: any) => ({
    label: link.label,
    href: link.url,
  })),
}))
---

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{pageTitle}</title>
  {seoDescription && <meta name="description" content={seoDescription} />}
  {settings?.favicon?.asset?.url && <link rel="icon" href={settings.favicon.asset.url} />}
</head>
<body class="bg-background text-foreground font-sans min-h-screen flex flex-col">

  <Navbar2
    siteName={settings?.siteName || 'MetaVivo'}
    links={navLinks}
    ctaText={ctaButton?.label}
    ctaHref={ctaButton?.url}
  />

  <main class="flex-1">
    <slot />
  </main>

  <Footer3
    companyName={settings?.siteName || 'MetaVivo'}
    description={settings?.footer?.tagline}
    columns={footerColumns}
    socialLinks={[]}
  />
</body>
</html>
