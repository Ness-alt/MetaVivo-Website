---
interface Props {
  value: any[]
}

const { value = [] } = Astro.props

function renderSpans(children: any[]): string {
  return (children || []).map((child: any) => {
    if (child._type !== 'span') return ''
    let text = child.text
    const marks = child.marks || []
    if (marks.includes('strong')) text = `<strong>${text}</strong>`
    if (marks.includes('em')) text = `<em>${text}</em>`
    return text
  }).join('')
}

function renderBlocks(blocks: any[]): string {
  let html = ''
  let inList = false
  let listTag = ''

  for (const block of blocks) {
    if (block._type !== 'block') continue

    // Close open list if this block is not a list item
    if (inList && !block.listItem) {
      html += `</${listTag}>`
      inList = false
    }

    const content = renderSpans(block.children)

    if (block.listItem) {
      if (!inList) {
        listTag = block.listItem === 'bullet' ? 'ul' : 'ol'
        html += listTag === 'ul'
          ? '<ul class="list-disc ml-6 mb-4 space-y-1">'
          : '<ol class="list-decimal ml-6 mb-4 space-y-1">'
        inList = true
      }
      html += `<li class="text-base leading-[1.4] text-foreground">${content}</li>`
      continue
    }

    const styleMap: Record<string, [string, string]> = {
      h1: ['h1', 'text-4xl font-bold leading-[1.2] mb-4 text-foreground'],
      h2: ['h2', 'text-3xl font-semibold leading-[1.2] mb-3 text-foreground'],
      h3: ['h3', 'text-xl font-semibold leading-[1.2] mb-2 text-foreground'],
      blockquote: ['blockquote', 'border-l-4 border-border pl-4 italic text-muted-foreground mb-4'],
      normal: ['p', 'text-base leading-[1.4] mb-4 text-foreground'],
    }

    const [tag, classes] = styleMap[block.style || 'normal'] || styleMap.normal
    html += `<${tag} class="${classes}">${content}</${tag}>`
  }

  if (inList) html += `</${listTag}>`
  return html
}

const rendered = renderBlocks(value)
---

<div class="prose max-w-none">{@html rendered}</div>
